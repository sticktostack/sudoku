<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sudoku</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #8057C7; /* light rgb background */
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin: 0;
      padding: 40px;
    }
    /* Sudoku grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(9, 45px);
      grid-template-rows: repeat(9, 45px);
      gap: 1px;
      background: #b92727;
      padding: 0x;
      border: none;
    }
    .cell {
      width: 45px;
      height: 45px;
      text-align: center;
      font-size: 18px;
      border: none;
      outline: none;
      background: white;
    }
    .cell:disabled {
      background: #74a8d5;
      color: black;
      font-weight: bold;
    }
    .highlight {
      background: #ebf58e !important;
    }
    .selected {
      background: #b2ebb8 !important;
    }
    /* Right panel */
    .sidebar {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .num-buttons {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
    }
    .num-buttons button,
    .control-buttons button {
      background: #c1c700;
      color: rgb(0, 0, 0);
      font-size: 18px;
      padding: 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .num-buttons button:hover,
    .control-buttons button:hover {
      background: #d9ff00;
    }
    .control-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div class="grid" id="sudoku-grid"></div>

  <div class="sidebar">
    <div class="num-buttons">
      <!-- Number buttons -->
      <button onclick="insertNumber(1)">1</button>
      <button onclick="insertNumber(2)">2</button>
      <button onclick="insertNumber(3)">3</button>
      <button onclick="insertNumber(4)">4</button>
      <button onclick="insertNumber(5)">5</button>
      <button onclick="insertNumber(6)">6</button>
      <button onclick="insertNumber(7)">7</button>
      <button onclick="insertNumber(8)">8</button>
      <button onclick="insertNumber(9)">9</button>
    </div>
    <div class="control-buttons">
      <button onclick="generatePuzzle()">Generate</button>
      <button onclick="solvePuzzle()">Solve</button>
      <button onclick="resetGrid()">Reset</button>
    </div>
  </div>

  <script>
    const grid = document.getElementById("sudoku-grid");
    let puzzle = [];
    let solution = [];
    let selectedCell = null;

    // Create grid inputs
    for (let r = 0; r < 9; r++) {
      for (let c = 0; c < 9; c++) {
        const input = document.createElement("input");
        input.type = "text";
        input.maxLength = 1;
        input.classList.add("cell");
        input.id = `cell-${r}-${c}`;
        input.addEventListener("focus", () => {
          selectedCell = {r, c};
          highlightCells(r, c);
        });
        grid.appendChild(input);
      }
    }

    function clearHighlights() {
      document.querySelectorAll(".cell").forEach(cell => {
        cell.classList.remove("highlight", "selected");
      });
    }

    function highlightCells(row, col) {
      clearHighlights();
      for (let i = 0; i < 9; i++) {
        document.getElementById(`cell-${row}-${i}`).classList.add("highlight");
        document.getElementById(`cell-${i}-${col}`).classList.add("highlight");
      }
      const startRow = Math.floor(row / 3) * 3;
      const startCol = Math.floor(col / 3) * 3;
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < 3; c++) {
          document.getElementById(`cell-${startRow+r}-${startCol+c}`).classList.add("highlight");
        }
      }
      document.getElementById(`cell-${row}-${col}`).classList.add("selected");
    }

    function insertNumber(num) {
      if (selectedCell) {
        const {r, c} = selectedCell;
        const cell = document.getElementById(`cell-${r}-${c}`);
        if (!cell.disabled) {
          cell.value = num;
          puzzle[r][c] = num;
        }
      }
    }

    async function generatePuzzle() {
      const res = await fetch("/generate");
      const data = await res.json();
      puzzle = data.puzzle;
      solution = data.solution;

      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          const cell = document.getElementById(`cell-${r}-${c}`);
          cell.value = puzzle[r][c] !== 0 ? puzzle[r][c] : "";
          cell.disabled = puzzle[r][c] !== 0;
        }
      }
    }

    async function solvePuzzle() {
      const res = await fetch("/solve", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({board: puzzle})
      });
      const data = await res.json();
      const solved = data.solution;

      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          document.getElementById(`cell-${r}-${c}`).value = solved[r][c];
        }
      }
    }

    function resetGrid() {
      clearHighlights();
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          const cell = document.getElementById(`cell-${r}-${c}`);
          cell.value = "";
          cell.disabled = false;
        }
      }
      puzzle = Array.from({length: 9}, () => Array(9).fill(0));
      selectedCell = null;
    }
  </script>
</body>
</html>
